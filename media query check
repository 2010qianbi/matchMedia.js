//test whether a media type or query applies in a given browser (examples at bottom)

/*
caveat: it needs doc.body to be ready because IE7 and under won't style the div if its appended to docElem. 
*/


//media query test
var mediaquery = (function(undefined){
  var cache = {},
    doc = document,
    docElem = doc.documentElement,
    head = doc.getElementsByTagName('head')[0] || docElem;
    
  return function(q){
    if (cache[q] === undefined) {
      var testDiv = doc.createElement('div');
      testDiv.setAttribute('id','ejs-qtest');
      var styleBlock = doc.createElement('style');
      styleBlock.type = 'text/css';
      var cssrule = '@media '+q+' { #ejs-qtest { position: absolute; width: 10px; } }';
      /*set inner css text. credit: http://www.phpied.com/dynamic-script-and-style-elements-in-ie/*/
      if (styleBlock.styleSheet){ 
          styleBlock.styleSheet.cssText = cssrule;
      } 
      else {
          styleBlock.appendChild(doc.createTextNode(cssrule));
      }      
      if(doc.body){
            doc.body.appendChild(testDiv);
            head.appendChild(styleBlock);
            var divWidth = testDiv.offsetWidth;
            doc.body.removeChild(testDiv);
            head.removeChild(styleBlock);
            cache[q] = (divWidth == 10);
      }
    }
    return cache[q];
  }
})();

//EXAMPLE USAGE


//test 'screen' media type
if(mediaquery('screen')){
  //screen media type supported
}

//test a handheld media query
if(mediaquery('screen and (device-max-width: 480px)')){
  //smartphone/iphone... maybe run some small-screen related dom scripting?
}
