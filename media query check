//test whether a media query applies
var checkmedia = (function(undefined){
  var cache = {},
    doc = document,
    docElem = doc.documentElement,
    head = doc.getElementsByTagName('head')[0] || docElem;
    
  return function(q){
    if (cache[q] === undefined) {
      var testDiv = doc.createElement('div');
      testDiv.setAttribute('id','ejs-qtest');
      var styleBlock = doc.createElement('style');
      styleBlock.type = 'text/css';
      var cssrule = '@media '+q+' { #ejs-qtest { position: absolute; width: 10px; } }';
      /*set inner css text. credit: http://www.phpied.com/dynamic-script-and-style-elements-in-ie/*/
      if (styleBlock.styleSheet){ 
          styleBlock.styleSheet.cssText = cssrule;
      } 
      else {
          styleBlock.appendChild(doc.createTextNode(cssrule));
      }      
      docElem.appendChild(testDiv);
      head.appendChild(styleBlock);
      var divWidth = testDiv.offsetWidth;
      docElem.removeChild(testDiv);
      head.removeChild(styleBlock);
      cache[q] = (divWidth == 10);
    }
    return cache[q];
  }
})();


//test 'screen' media type
if(checkmedia('screen')){
  //screen media type supported
}

//test a handheld media query
if(checkmedia('screen and (device-max-width: 480px)')){
  //smartphone/iphone... maybe run some small-screen related dom scripting?
}
